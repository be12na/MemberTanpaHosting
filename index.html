<!DOCTYPE html>
<html lang="id">
<head>
    <script src="config.js?v=2026"></script>

    <script>
        (function() {
            const CACHE_KEY = 'melimpah_global_settings';
            const CACHE_AGE = 60 * 60 * 1000; 
            window.waAdminGlobal = '';

            function applyGlobalSettings(data) {
                // Eksekusi Cepat (Favicon & Title Browser)
                if(data.site_favicon) {
                    let link = document.querySelector("link[rel~='icon']");
                    if (!link) { link = document.createElement('link'); link.rel = 'icon'; document.head.appendChild(link); }
                    link.href = data.site_favicon;
                }
                if(data.wa_admin) window.waAdminGlobal = data.wa_admin;
                
                // Auto Replace Text di Title Browser
                if(data.site_name) {
                    document.title = document.title.replace(/Melimpah Digital/gi, data.site_name).replace(/Melimpah/gi, data.site_name);
                }

                // Eksekusi DOM HTML (Menyuntikkan Teks ke Halaman)
                const updateDomElements = () => {
                    // Injeksi Komisi
                    if(data.affiliate_commission) {
                        const commEl = document.getElementById('display-comm-rate');
                        if(commEl) commEl.innerText = data.affiliate_commission + '%';
                    }
                    
                    // INJEKSI NAMA WEB
                    if(data.site_name) {
                        document.querySelectorAll('.dyn-site-name').forEach(el => {
                            el.innerText = data.site_name;
                        });
                    }
                    
                    // INJEKSI TAGLINE WEB
                    if(data.site_tagline) {
                        document.querySelectorAll('.dyn-site-tagline').forEach(el => {
                            el.innerText = data.site_tagline;
                        });
                    }
                };

                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', updateDomElements);
                } else {
                    updateDomElements();
                }
            }

            const cachedStr = localStorage.getItem(CACHE_KEY);
            let cached = null;
            try { cached = JSON.parse(cachedStr); } catch(e){}
            const now = Date.now();

            if (cached && cached.data) { applyGlobalSettings(cached.data); }

            // Menggunakan SCRIPT_URL yang ditarik dari config.js
            if (!cached || !cached.time || (now - cached.time > CACHE_AGE)) {
                if(typeof SCRIPT_URL === 'undefined') { console.error("SCRIPT_URL belum didefinisikan di config.js!"); return; }
                fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'get_global_settings' }) })
                    .then(res => res.json())
                    .then(r => {
                        if(r.status === 'success') {
                            localStorage.setItem(CACHE_KEY, JSON.stringify({ data: r.data, time: now }));
                            applyGlobalSettings(r.data); 
                        }
                    }).catch(e => console.error("Global Settings Sync Failed", e));
            }
        })();
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cepat Digital Tek</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        /* Animasi Muncul Halus */
        .fade-in { animation: fadeIn 0.4s ease-out forwards; opacity: 0; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        /* Delay beruntun untuk grid produk */
        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
    </style>
</head>
<body class="bg-[#f8f9fa] text-slate-800">

    <header class="bg-white/80 backdrop-blur-md border-b sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-20 flex justify-between items-center">
           <div class="text-xl md:text-2xl font-black text-indigo-600 tracking-tighter uppercase flex items-center gap-2">
                <i data-lucide="layers" class="w-6 h-6 md:w-8 md:h-8"></i>
                <strong class="dyn-site-name">MERUAH</strong>
            </div>
            <a href="login.html" class="bg-indigo-600 text-white px-6 py-2.5 rounded-full font-bold text-sm shadow-md shadow-indigo-200 hover:bg-indigo-700 hover:scale-105 transition-all">
                Login <i data-lucide="arrow-right" class="inline w-4 h-4 ml-1"></i>
            </a>
        </div>
    </header>

    <section class="max-w-7xl mx-auto px-6 py-20 text-center">
        <div class="inline-block bg-indigo-50 text-indigo-600 px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest mb-6 fade-in">Visi Baru Kreator</div>
        <h1 class="text-4xl md:text-6xl font-black tracking-tight mb-6 text-slate-900 fade-in delay-1">Tingkatkan Bisnis Digital Anda <br><span class="text-indigo-600">Hari Ini Juga.</span></h1>
        <p class="text-lg text-slate-500 max-w-2xl mx-auto mb-10 fade-in delay-2 dyn-site-tagline">Akses puluhan produk digital, template, dan kursus premium untuk memaksimalkan potensi bisnis dan konten Anda di era digital.</p>
        <a href="#katalog" class="inline-block bg-slate-900 text-white px-8 py-4 rounded-full font-bold text-lg shadow-xl shadow-slate-300 hover:scale-105 transition-all fade-in delay-3">Lihat Katalog Produk</a>
    </section>

    <section id="katalog" class="max-w-7xl mx-auto px-6 py-10 mb-20 scroll-mt-24">
        <div class="text-center mb-12">
            <h2 class="text-3xl font-black mb-4">Produk Digital Kami</h2>
            <p class="text-slate-500">Pilih produk yang paling sesuai dengan kebutuhan Anda.</p>
        </div>
        
        <div id="public-products" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <div id="katalog-loader" class="col-span-full text-center py-10">
                <div class="animate-spin w-8 h-8 border-4 border-indigo-600 border-t-transparent rounded-full mx-auto mb-4"></div>
                <p class="text-slate-400 text-xs font-bold uppercase tracking-widest animate-pulse">Menyiapkan Katalog...</p>
            </div>
        </div>
    </section>

    <footer class="bg-white border-t py-12 mt-20">
        <div class="max-w-7xl mx-auto px-6 grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left">
            <div>
                <h3 class="text-xl font-black text-indigo-600 mb-4 dyn-site-name uppercase">MELIMPAH</h3>
                <p class="text-sm text-slate-500 dyn-site-tagline">Platform penyedia produk digital dan kursus online terpercaya di Indonesia.</p>
            </div>
            <div>
                <h4 class="font-bold mb-4 text-slate-800">Informasi</h4>
                <ul class="text-sm text-slate-500 space-y-2">
                    <li><a href="/p.html?s=tentang-kami" class="hover:text-indigo-600 transition-colors">Tentang Kami</a></li>
                    <li><a href="/p.html?s=syarat-ketentuan" class="hover:text-indigo-600 transition-colors">Syarat & Ketentuan</a></li>
                    <li><a href="/p.html?s=kebijakan-privasi" class="hover:text-indigo-600 transition-colors">Kebijakan Privasi</a></li>
                </ul>
            </div>
            <div>
                <h4 class="font-bold mb-4 text-slate-800">Hubungi Kami</h4>
                <p class="text-sm text-slate-500 mb-2">Email: fira.zafirara@gmail.com</p>
                <p class="text-sm text-slate-500">WhatsApp: +62 887-1271-633</p>
            </div>
        </div>
        <div class="text-center text-xs text-slate-400 mt-12 pt-8 border-t">
            &copy; 2026 <span class="dyn-site-name">Melimpah Digital</span>. All rights reserved.
        </div>
    </footer>

    <script>
        // CACHE_KEY katalog tetap di sini
        const CACHE_KEY_CATALOG = 'melimpah_public_catalog';

        // Fungsi Render HTML Produk
        function renderCatalog(products) {
            const container = document.getElementById('public-products');
            
            if (!products || products.length === 0) {
                container.innerHTML = '<p class="text-slate-400 text-center col-span-full py-10 border-2 border-dashed rounded-3xl">Katalog sedang diperbarui. Silakan kembali lagi nanti.</p>';
                return;
            }

            container.innerHTML = [...products].reverse().map((p, index) => {
                let delayClass = `delay-${(index % 3) + 1}`;
                const targetLink = (p.lp_url && p.lp_url !== "") ? p.lp_url : `checkout.html?id=${p.id}`;

                return `
                <div class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-100 hover:shadow-xl hover:-translate-y-2 transition-all flex flex-col h-full fade-in ${delayClass}">
                    <div class="mb-6"><span class="bg-indigo-50 text-indigo-600 px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest">PRODUK DIGITAL</span></div>
                    <h3 class="text-xl font-bold text-slate-800 mb-2">${p.title}</h3>
                    <p class="text-sm text-slate-500 mb-8 flex-1 line-clamp-3">${p.desc || 'Akses materi terbaik kami di sini.'}</p>
                    <div class="flex items-center justify-between mt-auto pt-6 border-t border-slate-50">
                        <span class="text-lg font-black text-slate-800">Rp ${Number(p.harga).toLocaleString('id-ID')}</span>
                        <a href="${targetLink}" class="bg-slate-900 text-white px-6 py-3 rounded-xl font-bold text-xs hover:bg-indigo-600 transition-colors shadow-lg shadow-slate-200">Beli Sekarang</a>
                    </div>
                </div>
                `;
            }).join('');
            
            lucide.createIcons();
        }

        // --> FUNGSI LOADING SAT SET (Optimistic UI & Background Sync)
        async function loadPublicCatalog() {
            const cachedData = localStorage.getItem(CACHE_KEY_CATALOG);
            
            // JIKA ADA CACHE: Langsung render tanpa spinner loading!
            if (cachedData) {
                renderCatalog(JSON.parse(cachedData));
            } 

            // Pengecekan data terbaru di belakang layar
            try {
                if(typeof SCRIPT_URL === 'undefined') return; // Cek SCRIPT_URL dari config.js
                
                const res = await fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'get_products', email: '' }) });
                const r = await res.json();
                
                if (r.status === 'success') {
                    const freshData = JSON.stringify(r.available);
                    if(cachedData !== freshData) {
                        localStorage.setItem(CACHE_KEY_CATALOG, freshData);
                        renderCatalog(r.available);
                    }
                }
            } catch (err) { 
                console.error('Background sync failed', err);
                if (!cachedData) {
                    document.getElementById('public-products').innerHTML = '<p class="text-red-500 text-center col-span-full bg-red-50 py-4 rounded-2xl">Gagal memuat katalog. Coba refresh halaman.</p>';
                }
            }
        }
        
        window.onload = () => { 
            lucide.createIcons(); 
            loadPublicCatalog(); 
        };
    </script>
</body>
</html>